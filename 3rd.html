<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>points show</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: "Tajawal", sans-serif;
  margin: 0; padding: 0;
  background: linear-gradient(135deg, #74b9ff, #a29bfe, #ffeaa7, #fab1a0);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  display: flex; justify-content: center; align-items: center;
  height: 100vh; flex-direction: column;
}
@keyframes gradientBG {
  0% {background-position: 0% 50%;}
  50% {background-position: 100% 50%;}
  100% {background-position: 0% 50%;}
}
#welcome, #pointsPage { display: none; text-align: center; }
h1 { font-size: 2.4em; color: #2d3436; text-shadow: 2px 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
button {
  background: linear-gradient(45deg, #fd79a8, #e84393);
  color: white; border: none;
  padding: 14px 28px; border-radius: 12px; cursor: pointer;
  font-size: 1.2em; transition: transform 0.3s ease, box-shadow 0.3s ease;
}
button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 15px rgba(0,0,0,0.2);
}
.container {
  background: rgba(255,255,255,0.95);
  padding: 25px 20px;
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  width: 90%; max-width: 360px;
  box-sizing: border-box;
}
.container > * {
  margin-bottom: 16px;
}
input {
  width: 100%; padding: 14px;
  border: 1px solid #ccc; border-radius: 12px;
  font-size: 1.1em;
  transition: border 0.3s ease, box-shadow 0.3s ease;
  box-sizing: border-box;
}
input:focus {
  border-color: #6c5ce7;
  box-shadow: 0 0 8px rgba(108,92,231,0.5);
  outline: none;
}
.suggestions {
  background: #fff; border-radius: 12px; border: 1px solid #ddd;
  max-height: 150px; overflow-y: auto;
}
.suggestions div {
  padding: 10px; cursor: pointer; transition: background 0.3s ease;
  font-size: 1em;
}
.suggestions div:hover { background: #dfe6e9; }
#result {
  background: #f1f2f6;
  padding: 14px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  font-size: 1.2em;
  color: #2d3436;
  transition: opacity 0.5s ease;
}
@media (max-width: 480px) {
  h1 { font-size: 1.8em; }
  h2 { font-size: 1.4em; }
  button { font-size: 1em; padding: 12px 20px; }
  input, .suggestions div, #result { font-size: 1.1em; }
  .container { padding: 20px 16px; }
}

  #characterBox {
  text-align: center;
  margin-bottom: 20px;
}
#character {
  width: 150px;
  transition: all 0.3s ease;
}
.happy { transform: scale(1.2); }
.typing { transform: rotate(5deg); }
.waiting { animation: bounce 1s infinite; }
.result { transform: scale(1.4); }

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
  
</style>
</head>
<body>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
<div id="welcome">
  <h1>ğŸ¯ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ğŸ¯</h1>
  <button onclick="goToPoints()">Ø´ÙˆÙ Ù†Ù‚Ø§Ø·Ùƒ â­</button>
</div>

<!-- ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· -->
<div id="pointsPage">
  <div class="container">
    <h2>Ø´ÙˆÙ Ù†Ù‚Ø§Ø·Ùƒ â­</h2>
    <input id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
    <div class="suggestions" id="suggestions"></div>
    <button onclick="getPoints()">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    <div id="result"></div>
  </div>
  <!-- Ø´Ø®ØµÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ© -->
<div id="characterBox">
  <img id="character" src="https://copilot.microsoft.com/th/id/BCO.c93c7c4e-8a2f-4e1f-9b1e-6f2e6a3b7d1f.png" alt="Ø§Ù„Ø´Ø®ØµÙŠØ©" />
</div>
</div>

<script>
const apiURL = "https://3rd-system-grades.johnmamdouh777.workers.dev/?name=";
let allNames = [];

// Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
document.getElementById("welcome").style.display = "block";

// ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø¨Ø¯Ø±ÙŠ Ø¬Ø¯Ù‹Ø§ Ù…Ø¹ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© + ÙƒØ§Ø´ Ù…Ø­Ù„ÙŠ
async function loadNames() {
  const cached = localStorage.getItem("allNames");
  if (cached) {
    allNames = JSON.parse(cached);
    return;
  }
  try {
    const res = await fetch(apiURL + "load_names");
    const data = await res.json();
    if (data.names) {
      allNames = data.names;
      localStorage.setItem("allNames", JSON.stringify(allNames));
    }
  } catch (err) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡", err);
  }
}
window.addEventListener("DOMContentLoaded", loadNames);

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
const nameInput = document.getElementById("nameInput");
nameInput.addEventListener("input", () => {
  setCharacter("typing"); // Ø§Ù„Ø´Ø®ØµÙŠØ© ØªØªÙØ§Ø¹Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
  const val = nameInput.value.trim();
  const box = document.getElementById("suggestions");
  box.innerHTML = "";
  if (!val) return;
  const matches = allNames.filter(n => n.includes(val)).slice(0,5);
  matches.forEach(name => {
    const div = document.createElement("div");
    div.textContent = name;
    div.onclick = () => { nameInput.value = name; box.innerHTML = ""; };
    box.appendChild(div);
  });
});

// Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠØ©
function setCharacter(state) {
  const char = document.getElementById("character");
  char.className = ""; // reset
  switch(state) {
    case "start":
      char.src = "https://copilot.microsoft.com/th/id/BCO.3b1f5b6d-2e7e-4e7f-9c9f-9e6f6b3e9f3f.png"; // happy
      char.classList.add("happy");
      break;
    case "typing":
      char.src = "https://copilot.microsoft.com/th/id/BCO.4590a6d2-8b3e-4e2f-9c1e-7f2e6a3b9d2f.png"; // thinking
      char.classList.add("typing");
      break;
    case "waiting":
      char.src = "https://copilot.microsoft.com/th/id/BCO.b014f6c3-7a2e-4e3f-9d1e-6f3e7b2c8a1f.png"; // excited
      char.classList.add("waiting");
      break;
    case "result":
      char.src = "https://copilot.microsoft.com/th/id/BCO.ff3a6d2e-9c3e-4e2f-8c1e-5f2e6a3b7d1f.png"; // clap
      char.classList.add("result");
      break;
    default:
      char.src = "https://copilot.microsoft.com/th/id/BCO.c93c7c4e-8a2f-4e1f-9b1e-6f2e6a3b7d1f.png"; // idle
  }
}

// Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‚Ø§Ø·
function goToPoints() {
  document.getElementById("welcome").style.display = "none";
  document.getElementById("pointsPage").style.display = "block";
  setCharacter("start"); // Ø§Ù„Ø´Ø®ØµÙŠØ© ØªÙØ±Ø­ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Cloudflare
async function getPoints() {
  setCharacter("waiting"); // Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…ØªØ­Ù…Ø³Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  const name = nameInput.value.trim();
  const resultBox = document.getElementById("result");
  if (!allNames.includes(name)) {
    resultBox.innerText = "âŒ Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    return;
  }
  const res = await fetch(apiURL + encodeURIComponent(name));
  const data = await res.json();
  if (data.error) {
    resultBox.innerText = data.error;
  } else {
    resultBox.style.opacity = 0;
    setTimeout(() => {
      resultBox.innerHTML = `
        ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${data.name}<br>
        â­ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ©: ${data.total}<br>
        ğŸ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©: ${data.used}<br>
        â– Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®ØµÙˆÙ…Ø©: ${data.minus}<br>
        ğŸ† <strong>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${data.final}</strong>
      `;
      resultBox.style.opacity = 1;
      setCharacter("result"); // Ø§Ù„Ø´Ø®ØµÙŠØ© ØªØ³Ù‚Ù Ø£Ùˆ ØªÙØ±Ø­ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©
    }, 200);
  }
}
</script>
</body>
</html>
