<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>points show</title>
<style>
body {
  font-family: "Cairo", sans-serif;
  margin: 0; padding: 0;
  background: linear-gradient(to bottom right, #ffeaa7, #fab1a0);
  display: flex; justify-content: center; align-items: center;
  height: 100vh; flex-direction: column;
}
#welcome, #pointsPage { display: none; text-align: center; }
h1 { font-size: 2em; color: #2d3436; }
button {
  background: #fd79a8; color: white; border: none;
  padding: 10px 20px; border-radius: 10px; cursor: pointer;
  font-size: 1.2em; transition: 0.3s;
}
button:hover { background: #e84393; }
.container {
  background: white; padding: 20px; border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  width: 300px; margin-top: 20px;
}
input {
  width: 90%; padding: 10px; margin-bottom: 10px;
  border: 1px solid #ccc; border-radius: 10px;
}
.suggestions { background: #fff; border-radius: 10px; border: 1px solid #ddd; }
.suggestions div { padding: 5px; cursor: pointer; }
.suggestions div:hover { background: #f1f2f6; }
</style>
</head>
<body>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
<div id="welcome">
  <h1>ğŸ¯ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ¯</h1>
  <button onclick="goToPoints()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</button>
</div>

<!-- ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· -->
<div id="pointsPage">
  <div class="container">
    <h2>Ø´ÙˆÙ Ù†Ù‚Ø§Ø·Ùƒ â­</h2>
    <input id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
    <div class="suggestions" id="suggestions"></div>
    <button onclick="getPoints()">Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    <div id="result" style="margin-top:15px; font-size:18px;"></div>
  </div>
</div>

<script>
const apiURL = "https://3rd-system-grades.johnmamdouh777.workers.dev/?name=";
let allNames = [];

// Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
document.getElementById("welcome").style.display = "block";

// Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‚Ø§Ø·
function goToPoints() {
  document.getElementById("welcome").style.display = "none";
  document.getElementById("pointsPage").style.display = "block";
  loadNames();
}

// ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ù…Ù† Google Sheet
async function loadNames() {
  const res = await fetch(apiURL + "load_names");
  const data = await res.json();
  if (data.names) allNames = data.names;
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
const nameInput = document.getElementById("nameInput");
nameInput.addEventListener("input", () => {
  const val = nameInput.value.trim();
  const box = document.getElementById("suggestions");
  box.innerHTML = "";
  if (!val) return;
  const matches = allNames.filter(n => n.includes(val)).slice(0,5);
  matches.forEach(name => {
    const div = document.createElement("div");
    div.textContent = name;
    div.onclick = () => { nameInput.value = name; box.innerHTML = ""; };
    box.appendChild(div);
  });
});

// Ø¬Ù„Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Cloudflare
async function getPoints() {
  const name = nameInput.value.trim();
  if (!allNames.includes(name)) {
    document.getElementById("result").innerText = "âŒ Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    return;
  }
  const res = await fetch(apiURL + encodeURIComponent(name));
  const data = await res.json();
  if (data.error) {
    document.getElementById("result").innerText = data.error;
  } else {
    document.getElementById("result").innerHTML = `
      Ø§Ù„Ø§Ø³Ù…: ${data.name}<br>
      Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ©: ${data.total}<br>
      Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©: ${data.used}<br>
      Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®ØµÙˆÙ…Ø©: ${data.minus}<br>
      <strong>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${data.final}</strong>
    `;
  }
}
</script>
</body>
</html>
